var myApp = angular.module("myApp", ['ui.router'])
    .config(["$stateProvider", "$urlRouterProvider", "$locationProvider", function($stateProvider, $urlRouterProvider, $locationProvider) {
        $urlRouterProvider.otherwise("/landing");
        $locationProvider.hashPrefix('');

        $stateProvider
            .state('landing', {
                url: "/landing",
                templateUrl: "app/directives/landing/landing.template.html"
            })
            .state('calculo', {
                url: "/calculo",
                templateUrl: "app/directives/calc/calc.template.html"
            });
    }]);;myApp.factory("Equipment", ["$http", function($http) {
    var _getEquipments = function() {
        return $http.get("https://private-7a98db-senaienergy.apiary-mock.com/device");
    }

    var _getCompanys = function() {
        return $http.get("https://private-7a98db-senaienergy.apiary-mock.com/companys");
    }

    return {
        getEquipments: _getEquipments,
        getCompanys: _getCompanys
    };
}]);;myApp.controller("calcController", ['Equipment', '$scope', function(Equipment, $scope) {
    $scope.deviceList = [];

    $scope.getEquipments = function(){
        Equipment.getEquipments($scope.deviceList)
        .then(function(promisse) {
            $scope.deviceList = promisse.data;
        })
    }

    $scope.getCompanys = function() {
        console.log("Chamou");
        Equipment.getCompanys()
        .then(function(promisse) {
            $scope.companysList = promisse.data;
            console.log($scope.companysList);
        })
    }

    $scope.getCompanys();
    
    // $scope.deviceList = {
    //     devices: [{
    //         name: "LÃ¢mpada Fluorescente",
    //         power: 20,
    //         quantity: 1,
    //         consumption: 2.00,
    //         schedule: [120, 120, 0]
    //     },
    //     {
    //         name: "Teste",
    //         power: 15,
    //         quantity: 2,
    //         consumption: 2.00,
    //         schedule: [135, 514, 0]
    //     }]
    // };

    $scope.addDevice = function() {
        $scope.deviceList.push($scope.newDevice);
    }

    $scope.deleteDevice = function($index) {
        console.log($index);
        console.log($scope.deviceList)
        $scope.deviceList.splice($index, 1);
    }

    $scope.openModal = function() {
        var modal = document.getElementsByClassName("modal");
        modal[0].style.display = "block";
    }

    $scope.closeModal = function() {
        var modal = document.getElementsByClassName("modal");
        modal[0].style.display = "none";
    }

    $scope.getEquipments();
    
}]);;myApp.directive('stringToNumber', function() {
    return {
      require: 'ngModel',
      link: function(scope, element, attrs, ngModel) {
        ngModel.$parsers.push(function(value) {
          return '' + value;
        });
        ngModel.$formatters.push(function(value) {
          return parseFloat(value, 10);
        });
      }
    };
  });